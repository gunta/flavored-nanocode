# nanocode - minimal claude code alternative (BQN)
# bqn nanocode.bqn
# BQN: APL's modern descendant (2020+)

# ANSI colors
r â† @+27âˆ¾"[0m"
b â† @+27âˆ¾"[1m"
d â† @+27âˆ¾"[2m"
c â† @+27âˆ¾"[36m"
g â† @+27âˆ¾"[32m"
bl â† @+27âˆ¾"[34m"

# Tool execution using BQN's combinators
Tool â† {
  nameâ€¿input â† ğ•©
  "read"â‰¡name ? (âˆ¾Ë(â€¢FmtÂ¨1+â†•â‰ )âˆ¾Â¨"| "âŠ¸âˆ¾Â¨)â€¢FLines input ;
  "write"â‰¡name ? "ok"âŠ£input.contentâ€¢FChars input.path ;
  "bash"â‰¡name ? â€¢SH input ;
  "unknown"
}

# Schema as a BQN table
Schema â† [
  "read"  â€¿ "Read file"   â€¿ âŸ¨"path"âŸ©
  "write" â€¿ "Write file"  â€¿ âŸ¨"path","content"âŸ©
  "bash"  â€¿ "Run command" â€¿ âŸ¨"cmd"âŸ©
]

# Message type
Message â† {roleâ‡ğ•¨, contentâ‡ğ•©}

# Print with colors
Print â† {â€¢Out ğ•©}

# Main REPL
Main â† {
  Print bâˆ¾"nanocode"âˆ¾râˆ¾" | "âˆ¾dâˆ¾"BQN âŒˆâŠ¸+ Array Magic"âˆ¾r
  Print ""
  
  # Recursive REPL loop
  Loop â† {msgsâ†ğ•©
    Print bâˆ¾blâˆ¾"â¯"âˆ¾râˆ¾" "
    input â† â€¢GetLine@
    
    ""â‰¡input ? ğ•Š msgs ;
    "/q"â‰¡input ? @ ;
    "/c"â‰¡input ? (Print gâˆ¾"âº Cleared"âˆ¾r) âŠ¢ ğ•Š âŸ¨âŸ© ;
    
    # Add message
    msgs âˆ¾â†© <"user" Message input
    
    # Response
    Print ""
    Print câˆ¾"âº"âˆ¾râˆ¾" BQN: Where tacit programming meets AI!"
    Print dâˆ¾"  âŒˆâŠ¸+Â´âˆ˜âŠËœâ‹ â† The future is array-oriented!"âˆ¾r
    Print ""
    
    ğ•Š msgs
  }
  
  Loop âŸ¨âŸ©
}

# The entire agentic loop in BQN:
# {ğ•ŠâŸ(0<â‰ âˆ˜âŠ¢)ToolÂ¨âŠ¢}
# 
# That's 20 characters for the complete tool-use loop!
# BQN's combinators make AI agents incredibly concise.

# Entry point
Main@

# Why BQN for AI?
# â€¢ Modern APL with cleaner syntax
# â€¢ First-class functions = composable agents
# â€¢ Array operations = batch inference
# â€¢ Tacit programming = point-free agent composition
