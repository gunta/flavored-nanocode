# nanocode - minimal claude code alternative (Uiua)
# uiua run nanocode.ua
# Uiua: A stack-based array language (2023+)

# ANSI colors
R â† "\e[0m"
B â† "\e[1m"
D â† "\e[2m"
C â† "\e[36m"
G â† "\e[32m"
BL â† "\e[34m"

# Tool execution using stack operations
Read â† (
  &fras           # Read file
  âŠœâ–¡ â‰ @\n .      # Split by newlines
  â‰¡(âŠ‚ "| " âŠ‚â‹•âŠ™.) # Add line numbers
  âŠƒâŠ¢/âŠ‚            # Join with newlines
)

Write â† (
  &fwa            # Write file
  "ok"            # Return ok
)

Bash â† (
  &rs "sh" "-c"  # Run shell command
)

# Tool dispatcher
Tool â† (
  âŠ™âŠ™âŠ™âŠ™â‰¡Â°â–¡        # Unbox arguments
  âŠ— {"read" "write" "bash" "glob" "grep"}  # Find tool index
  (Read|Write|Bash|"files..."|"matches...") # Dispatch
)

# Print header
&p âŠ‚ B âŠ‚ "nanocode" âŠ‚ R âŠ‚ " | " âŠ‚ D âŠ‚ "Uiua ğŸš Stack Magic" R
&p ""

# Schema
Schema â† {
  "read": {"description": "Read file", "required": ["path"]}
  "write": {"description": "Write file", "required": ["path", "content"]}
  "bash": {"description": "Run command", "required": ["cmd"]}
}

# Main loop
Messages â† []

Loop â† (
  &p âŠ‚ B âŠ‚ BL âŠ‚ "â¯" âŠ‚ R " "
  &sc                    # Read input
  
  # Handle commands
  âŠ— {"" "/q" "/c"} .    # Check for special commands
  (
    â—Œ Loop             # Empty: continue
  | â—Œ "Goodbye!"       # /q: quit
  | â—Œ &p âŠ‚ G âŠ‚ "âº Cleared" R
    [] Loop            # /c: clear and continue
  | # Normal input
    &p ""
    &p âŠ‚ C âŠ‚ "âº" âŠ‚ R " Uiua speaks in stacks! âŠ‚âŠƒâŠ¢/âŠ‚"
    &p âŠ‚ D âŠ‚ "  Where tacit meets AI!" R
    &p ""
    
    # Would add to messages and call API
    Loop
  )
)

Loop

# The Uiua agentic loop:
# â¥(Tool âŠƒâŠ¢/âŠ‚)
# 
# Just 9 glyphs! Stack-based languages are incredibly
# concise for expressing computation flows.
#
# In the AI era, Uiua's visual operators could map
# directly to attention patterns:
#   âŠƒ = fork (parallel processing)
#   âŠ‚ = join (concatenation)
#   â‰¡ = rows (batched operations)
